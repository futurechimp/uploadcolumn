<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: UploadColumn::UploadedFile</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">UploadColumn::UploadedFile</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/upload_column_rb.html">
                lib/upload_column.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <h1>Basics</h1>
<p>
When you call an upload_column field, an instance of this class will be
returned.
</p>
<p>
Suppose a <tt>User</tt> model has a <tt>picture</tt> upload_column, like
so:
</p>
<pre>
    class User &lt; ActiveRecord::Base
      upload_column :picture
    end
</pre>
<p>
Now in our controller we did:
</p>
<pre>
    @user = User.find(params[:id])
</pre>
<p>
We could then access the file:
</p>
<pre>
    @user.picture.url
</pre>
<p>
Which would output the url to the file (assuming it is stored in /public/)
</p>
<h1>Versions</h1>
<p>
If we had instead added different versions in our model
</p>
<pre>
    upload_column :picture, :versions =&gt; [:thumb, :large]
</pre>
<p>
Then we could access them like so:
</p>
<pre>
    @user.picture.thumb.url
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000009">assign</a>&nbsp;&nbsp;
      <a href="#M000011">delete</a>&nbsp;&nbsp;
      <a href="#M000008">exists?</a>&nbsp;&nbsp;
      <a href="#M000022">filename</a>&nbsp;&nbsp;
      <a href="#M000023">filename=</a>&nbsp;&nbsp;
      <a href="#M000019">filename_base</a>&nbsp;&nbsp;
      <a href="#M000020">filename_extension</a>&nbsp;&nbsp;
      <a href="#M000021">mime_type</a>&nbsp;&nbsp;
      <a href="#M000006">new</a>&nbsp;&nbsp;
      <a href="#M000014">path</a>&nbsp;&nbsp;
      <a href="#M000012">process</a>&nbsp;&nbsp;
      <a href="#M000013">process!</a>&nbsp;&nbsp;
      <a href="#M000018">relative_dir</a>&nbsp;&nbsp;
      <a href="#M000015">relative_path</a>&nbsp;&nbsp;
      <a href="#M000010">save</a>&nbsp;&nbsp;
      <a href="#M000007">size</a>&nbsp;&nbsp;
      <a href="#M000017">store_dir</a>&nbsp;&nbsp;
      <a href="#M000016">url</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">attribute</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">dir</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">instance</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">options</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">suffix</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">versions</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(options, instance, attribute, dir = nil, filename = nil, suffix = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 103</span>
103:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">instance</span>, <span class="ruby-identifier">attribute</span>, <span class="ruby-identifier">dir</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">filename</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">suffix</span> = <span class="ruby-keyword kw">nil</span>)
104:       <span class="ruby-identifier">options</span> = <span class="ruby-constant">DEFAULT_OPTIONS</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
105:   
106:       <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">options</span>
107:       <span class="ruby-ivar">@instance</span> = <span class="ruby-identifier">instance</span>
108:       <span class="ruby-ivar">@attribute</span> = <span class="ruby-identifier">attribute</span>
109:       <span class="ruby-ivar">@filename</span> = <span class="ruby-identifier">filename</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">instance</span>[<span class="ruby-identifier">attribute</span>]
110:       <span class="ruby-ivar">@suffix</span> = <span class="ruby-identifier">suffix</span>
111:   
112:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dir</span>
113:         <span class="ruby-ivar">@dir</span> = <span class="ruby-identifier">dir</span>
114:       <span class="ruby-keyword kw">else</span>
115:         <span class="ruby-ivar">@dir</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:store_dir_append_id</span>]
116:       <span class="ruby-keyword kw">end</span>
117:       
118:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:web_root</span>].<span class="ruby-identifier">blank?</span>
119:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:web_root</span>] = <span class="ruby-value str">'/'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:web_root</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:web_root</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">%r{^/}</span>
120:       <span class="ruby-keyword kw">end</span>
121:       
122:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:tmp_dir</span>].<span class="ruby-identifier">blank?</span>
123:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:tmp_dir</span>][<span class="ruby-value">0</span>] = <span class="ruby-value str">''</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:tmp_dir</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">%r{^/}</span>
124:       <span class="ruby-keyword kw">end</span>
125:   
126:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">suffix</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:versions</span>]
127:         <span class="ruby-ivar">@versions</span> = {}
128:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">version</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:versions</span>]
129:           <span class="ruby-identifier">version</span> = <span class="ruby-identifier">version</span>[<span class="ruby-value">0</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">version</span>.<span class="ruby-identifier">is_a?</span>( <span class="ruby-constant">Array</span> )
130:           <span class="ruby-ivar">@versions</span>[<span class="ruby-identifier">version</span>.<span class="ruby-identifier">to_sym</span>] = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">options</span>, <span class="ruby-identifier">instance</span>, <span class="ruby-identifier">attribute</span>, <span class="ruby-identifier">dir</span>, <span class="ruby-identifier">filename</span>, <span class="ruby-identifier">version</span>.<span class="ruby-identifier">to_s</span> )
131:         <span class="ruby-keyword kw">end</span>
132:       <span class="ruby-keyword kw">end</span>
133:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">assign</span><span class="method-args">(file, directory = nil )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Assigns a file to this upload column and stores it in a temporary file,
Bypasses the _after_assign callback use +UploadedFile::save+ to store the
file to its permanent location!
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 158</span>
158:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">assign</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">directory</span> = <span class="ruby-keyword kw">nil</span> )
159:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">nil?</span>
160:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
161:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
162:         <span class="ruby-keyword kw">else</span>
163:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
164:             <span class="ruby-comment cmt"># if file is a non-empty string it is most probably</span>
165:             <span class="ruby-comment cmt"># the filename and the user forgot to set the encoding</span>
166:             <span class="ruby-comment cmt"># to multipart/form-data. Since we would raise an exception</span>
167:             <span class="ruby-comment cmt"># because of the missing &quot;original_filename&quot; method anyways,</span>
168:             <span class="ruby-comment cmt"># we raise a more meaningful exception rightaway.</span>
169:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Do not know how to handle a string with value '#{file}' that was passed to an upload_column. Check if the form's encoding has been set to 'multipart/form-data'.&quot;</span>)
170:           <span class="ruby-keyword kw">end</span>
171:       
172:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
173:       
174:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">dir</span> = <span class="ruby-identifier">directory</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">join_path</span>( <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:tmp_dir</span>], <span class="ruby-identifier">generate_temp_name</span> )            
175:       
176:             <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkpath</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">store_dir</span>)
177:             
178:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filename</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>
179: 
180:             <span class="ruby-comment cmt"># stored uploaded file into self.path</span>
181:             <span class="ruby-comment cmt"># If it was a Tempfile object, the temporary file will be</span>
182:             <span class="ruby-comment cmt"># cleaned up automatically, so we do not have to care for this</span>
183:             <span class="ruby-comment cmt"># Large files will be passed as tempfiles, whereas small ones</span>
184:             <span class="ruby-comment cmt"># will be passed as StringIO</span>
185:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:local_path</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">local_path</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">local_path</span>)
186:               <span class="ruby-identifier">fix_file_extension</span>( <span class="ruby-identifier">file</span>, <span class="ruby-identifier">file</span>.<span class="ruby-identifier">local_path</span> )
187:               <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">copy_file</span>( <span class="ruby-identifier">file</span>.<span class="ruby-identifier">local_path</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span> )
188:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:read</span>)
189:               <span class="ruby-identifier">fix_file_extension</span>( <span class="ruby-identifier">file</span>, <span class="ruby-keyword kw">nil</span> )
190:               <span class="ruby-identifier">file</span>.<span class="ruby-identifier">rewind</span> <span class="ruby-comment cmt"># Make sure we are at the beginning of the buffer</span>
191:               <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span>, <span class="ruby-value str">&quot;wb&quot;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">file</span>.<span class="ruby-identifier">read</span>) }
192:             <span class="ruby-keyword kw">else</span>
193:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;Do not know how to handle #{file.inspect}&quot;</span>)
194:             <span class="ruby-keyword kw">end</span>
195:                   
196:             <span class="ruby-identifier">versions</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">assign</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">dir</span>) } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">versions</span>
197:             
198:             <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">true</span>
199:           <span class="ruby-keyword kw">end</span>
200:         <span class="ruby-keyword kw">end</span>
201:       <span class="ruby-keyword kw">end</span>
202:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Delete this file, note that it will only delete the FILE, not the value in
the database
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 234</span>
234:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>
235:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">dir</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">store_dir</span>
236:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">store_dir</span> )
237:       <span class="ruby-keyword kw">else</span>
238:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span> ) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span> )
239:         <span class="ruby-identifier">versions</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">delete</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">versions</span>
240:       <span class="ruby-keyword kw">end</span>
241:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">exists?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 143</span>
143:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">exists?</span>
144:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span>)
145:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">filename</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
returns the file&#8217;s name
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 369</span>
369:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filename</span>
370:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">suffix</span>.<span class="ruby-identifier">nil?</span>
371:         <span class="ruby-ivar">@filename</span>
372:       <span class="ruby-keyword kw">else</span>
373:         <span class="ruby-node">&quot;#{filename_base}-#{suffix}.#{filename_extension}&quot;</span>
374:       <span class="ruby-keyword kw">end</span>
375:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">filename=</span><span class="method-args">(name)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Set the filename, use at your own risk!
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 378</span>
378:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filename=</span>(<span class="ruby-identifier">name</span>)
379:       <span class="ruby-ivar">@filename</span> = <span class="ruby-identifier">sanitize_filename</span>( <span class="ruby-identifier">name</span> )
380:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">filename_base</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the filename without the extension
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 345</span>
345:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filename_base</span>
346:       <span class="ruby-identifier">split_extension</span>[<span class="ruby-value">0</span>]
347:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">filename_extension</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the file&#8217;s extension
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 350</span>
350:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filename_extension</span>
351:       <span class="ruby-identifier">split_extension</span>[<span class="ruby-value">1</span>]
352:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">mime_type</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Guesses the mime-type of the file based on it&#8217;s extension, returns a
String.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 355</span>
355:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mime_type</span>
356:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">filename_extension</span>
357:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;jpg&quot;</span><span class="ruby-operator">:</span>
358:         <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;image/jpeg&quot;</span>
359:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;gif&quot;</span><span class="ruby-operator">:</span>
360:         <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;image/gif&quot;</span>
361:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;png&quot;</span><span class="ruby-operator">:</span>
362:         <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;image/png&quot;</span>
363:       <span class="ruby-keyword kw">else</span>
364:         <span class="ruby-constant">MIME_EXTENSIONS</span>.<span class="ruby-identifier">invert</span>[<span class="ruby-identifier">filename_extension</span>]
365:       <span class="ruby-keyword kw">end</span>
366:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000014" class="method-detail">
        <a name="M000014"></a>

        <div class="method-heading">
          <a href="#M000014" class="method-signature">
          <span class="method-name">path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the absolute path of the file
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000014-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000014-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 304</span>
304:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">path</span>()
305:       <span class="ruby-identifier">join_path</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">store_dir</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filename</span>)
306:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">process</span><span class="method-args">() {|img| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Processes the file with RMagick. This works only if the file is an image
that RMagick can understand. The image is loaded using +Image::read+ and
then passed to a block, <tt>process</tt> then returns the result of the
block, like so:
</p>
<pre>
    new_image = @user.picture.process do |img|
      img = img.thumbnail( 0.1 )
      img.solarize
    end
</pre>
<p>
Resulting in an image shrunk to 10% of the original size and solarized. For
more information on what you can do inside a <tt>process</tt> block, see
the RMagick doumentation at: <a
href="http://www.simplesystems.org/RMagick/doc/index.html">www.simplesystems.org/RMagick/doc/index.html</a>.
</p>
<p>
Note that you will need to &#8216;carry&#8217; the image since most Rmagick
methods do not modify the image itself but rather return the result of the
transformation.
</p>
<p>
Note also that unlike RMagicks&#8217;s read, this method will return nil if
the image cannot be opened, it will not throw an Error, so you can happily
apply this, even if you aren&#8217;t sure that the file is an image.
</p>
<p>
+process!+ is usually more useful, don&#8217;t use <tt>process</tt> unless
there is a good reason to!
</p>
<p>
Remember to call GC.start after you are done processing the image, to avoid
memory leaks.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 264</span>
264:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process</span>
265:       <span class="ruby-comment cmt"># Load the file as a ImageMagick object, pass to block, return the yielded result</span>
266:       <span class="ruby-keyword kw">begin</span>
267:         <span class="ruby-identifier">img</span> = <span class="ruby-operator">::</span><span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">Image</span><span class="ruby-operator">::</span><span class="ruby-identifier">read</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span>).<span class="ruby-identifier">first</span>
268:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Magick</span><span class="ruby-operator">::</span><span class="ruby-constant">ImageMagickError</span>
269:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
270:       <span class="ruby-keyword kw">end</span>
271:       <span class="ruby-keyword kw">yield</span>( <span class="ruby-identifier">img</span> )
272:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000013" class="method-detail">
        <a name="M000013"></a>

        <div class="method-heading">
          <a href="#M000013" class="method-signature">
          <span class="method-name">process!</span><span class="method-args">() {|img| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Like <tt>process</tt>, but instead of returning the new image, it will
replace this one. Use +process!+ in an _after_assign callback, like so:
</p>
<pre>
    class User &lt; ActiveRecord::Base
      upload_column :picture

      def picture_after_assign
        picture.process! do |img|
          img.solarize
        end
      end

    end
</pre>
<p>
This is an easy way to apply some RMagick effect to an image right after
it&#8217;s uploaded
</p>
<p>
Note that this method will silently fail if the image cannot be opened, so
you can happily apply this, even if you aren&#8217;t sure that the file is
an images.
</p>
<p>
To prevent memory leaks, process! will call GC.start manually.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000013-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000013-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 292</span>
292:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process!</span>
293:       <span class="ruby-identifier">img</span> = <span class="ruby-identifier">process</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">img</span><span class="ruby-operator">|</span>
294:         <span class="ruby-identifier">img</span> = <span class="ruby-keyword kw">yield</span>( <span class="ruby-identifier">img</span> )
295:       <span class="ruby-keyword kw">end</span>
296:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">img</span>.<span class="ruby-identifier">nil?</span>
297:       <span class="ruby-identifier">img</span>.<span class="ruby-identifier">write</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span>
298:       <span class="ruby-identifier">img</span> = <span class="ruby-keyword kw">nil</span>
299:       <span class="ruby-constant">GC</span>.<span class="ruby-identifier">start</span>
300:       <span class="ruby-keyword kw">true</span>
301:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">relative_dir</span><span class="method-args">( root_dir = false )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Like <tt><a href="UploadedFile.html#M000017">store_dir</a></tt> but will
return the directory relative to the :root_path option
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 331</span>
331:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">relative_dir</span>( <span class="ruby-identifier">root_dir</span> = <span class="ruby-keyword kw">false</span> )
332:       <span class="ruby-comment cmt"># Increase speed by bypassing this code if it's called multiple times</span>
333:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@relative_dir</span>
334:         <span class="ruby-identifier">model</span> = <span class="ruby-constant">Inflector</span>.<span class="ruby-identifier">underscore</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">class</span>).<span class="ruby-identifier">to_s</span>
335:         <span class="ruby-identifier">sd</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">send</span>(<span class="ruby-node">&quot;#{self.attribute}_store_dir&quot;</span>)
336:         <span class="ruby-identifier">sd</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:store_dir</span>]
337:         <span class="ruby-identifier">sd</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">join_path</span>(<span class="ruby-identifier">model</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">attribute</span>.<span class="ruby-identifier">to_s</span>)
338:         <span class="ruby-ivar">@relative_dir</span> = <span class="ruby-identifier">sd</span>
339:       <span class="ruby-keyword kw">end</span>
340:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">join_path</span>( <span class="ruby-ivar">@relative_dir</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">dir</span> ) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">root_dir</span>
341:       <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@relative_dir</span>
342:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000015" class="method-detail">
        <a name="M000015"></a>

        <div class="method-heading">
          <a href="#M000015" class="method-signature">
          <span class="method-name">relative_path</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the path of the file, relative to <a
href="UploadedFile.html#M000017">store_dir</a>( true ) Note: this is not
relative to the same directory as <a
href="UploadedFile.html#M000018">relative_dir</a>, I am aware that that
makes no sense whatsoever, but until I come up with a better name for one
of the methods it&#8217;ll have to do, suggestions are appreciated :)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000015-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000015-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 312</span>
312:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">relative_path</span>()
313:       <span class="ruby-identifier">join_path</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">dir</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filename</span>)
314:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">save</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Save the file to the permanent location
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 205</span>
205:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save</span>
206:       <span class="ruby-identifier">new_dir</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:store_dir_append_id</span>] <span class="ruby-keyword kw">then</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">else</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">end</span>
207:       <span class="ruby-identifier">new_abs_dir</span> = <span class="ruby-identifier">join_path</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">store_dir</span>(<span class="ruby-keyword kw">true</span>), <span class="ruby-identifier">new_dir</span> )
208:       <span class="ruby-identifier">new_path</span> = <span class="ruby-identifier">join_path</span>( <span class="ruby-identifier">new_abs_dir</span>, <span class="ruby-identifier">filename</span> )
209:   
210:       <span class="ruby-comment cmt"># Check if a new file has actually been assigned</span>
211:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filename</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filename</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">new_path</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span>
212:    
213:         <span class="ruby-comment cmt"># create the directory first</span>
214:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkpath</span>(<span class="ruby-identifier">new_abs_dir</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-identifier">new_abs_dir</span>)
215: 
216:         <span class="ruby-comment cmt"># move the temporary file over</span>
217:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span>( <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span>, <span class="ruby-identifier">new_path</span> )
218: 
219:         <span class="ruby-comment cmt"># remove the old file, do this after in case copying fails.      </span>
220:         <span class="ruby-comment cmt">#self.delete if options[:replace_old_files]</span>
221:   
222:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">dir</span> = <span class="ruby-identifier">new_dir</span>
223:     
224:         <span class="ruby-identifier">versions</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span>.<span class="ruby-identifier">save</span> } <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">versions</span>
225:       <span class="ruby-keyword kw">end</span>
226:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">size</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 139</span>
139:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">size</span>
140:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">size</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">path</span>)
141:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">store_dir</span><span class="method-args">( root_dir = false )</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the directory where the file is (or will be) permanently stored
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 326</span>
326:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">store_dir</span>( <span class="ruby-identifier">root_dir</span> = <span class="ruby-keyword kw">false</span> )
327:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">relative_dir</span>( <span class="ruby-identifier">root_dir</span> ), <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:root_path</span>])
328:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">url</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the URL of the file, you can use this in your views to easily
create links to your files:
</p>
<pre>
    &lt;%= link_to &quot;#{@song.title} Tab&quot;, @song.guitar_tab.url %&gt;
</pre>
<p>
Or if your file is an image, you can use <tt>url</tt> like so:
</p>
<pre>
    &lt;%= image_tag @user.picture.url %&gt;
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
     <span class="ruby-comment cmt"># File lib/upload_column.rb, line 321</span>
321:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">url</span>
322:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:web_root</span>] <span class="ruby-operator">+</span> ( <span class="ruby-value str">&quot;/&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">relative_dir</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;\\&quot;</span>, <span class="ruby-value str">&quot;/&quot;</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;/&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">filename</span> )
323:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>